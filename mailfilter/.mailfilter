# Global maildrop filter file

# support showing X11 graphical prompts during mail delivery
#import DISPLAY
# if nothing else matches then mails end up here
DEFAULT="$HOME/.mail/"

# general spam stuff

#if( /^From: ID WORLD/:h )
#{
#	to "$HOME/.mail/.spam"
#}

# if( /^From: .*newsletter.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^From: .*SUSE Confluence Recommended.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^From: .*partnernet.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^From: .*twitter.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^Subject: .*Watches.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^From: .*sophos.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

if( /^From: .*news@suse.*/:h )
{
	to "$HOME/.mail/.suse_communications"
}

if( /^From: .*SUSEComms@suse.*/:h && /^To:.*all@suse.*/:h )
{
	to "$HOME/.mail/.suse_communications"
}


# if( /^From: .*news@.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }

# if( /^From: .*info@.*/:h )
# {
# 	to "$HOME/.mail/.spam"
# }


# filter out uninteresting agent mails

if( /^From: bugzilla_noreply@suse.com/:h && /SMASH.*smash_bz@suse.de.*changed.*:/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: bugzilla_noreply@suse.com/:h && /This is an autogenerated message for openQA.*/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: bugzilla_noreply@suse.com/:h && /Maintenance Robot.*changed.*:/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: maint-coord@suse.de/:h && /^Subject:.*SMASH.*Maintenance update request.*/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: bugzilla_noreply@suse.com/:h && /^Swamp Workflow Management.*changed/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: bugzilla_noreply@suse.com/:h && /Comment.*from Swamp Workflow Management.*/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: bugzilla_noreply@suse.com/:h && /^This is an autogenerated message.*/:b )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: OpenQA Checker.*/:h )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}

if( /^From: .*openqa-maintenance@suse.de.*/:h )
{
	FLAGS="S"
	to "$HOME/.mail/.agents"
}


# collect special security agent mails in a separate mailbox

if( /^(To|Cc):.*security-reports@suse.de/:h )
{
	to "$HOME/.mail/.security_reports"
}

# collect build service notification separately

if( /^Sender: OBS Notification.*/:h )
{
	# but not stupid ones
	if( /^Subject: Build failure of.*rpmlint.*/:h )
	{
		FLAGS="S"
	}
	to "$HOME/.mail/.buildservice"
}

# if directly adressed to me skip all else
if( /^(To|Cc): .*.p*paolo@suse.(de|com).*/:h )
{
	#`$HOME/bin/mail_status.py -n direct`
	to "$HOME/.mail"
}

# collect mailing lists

if( /^(To|Cc):.*oss-security@lists.openwall.com.*/:h )
{
	#`$HOME/bin/mail_status.py -n "oss-sec"`
	to "$HOME/.mail/.list_oss-sec"
}

if( /^List-Id:.*oss-security.lists.openwall.com/:h )
{
	to "$HOME/.mail/.list_oss-sec"
}


#if( /^(To|Cc):.*linux-distros@lists.openwall.com.*/:h )
#{
#	#`$HOME/bin/mail_status.py -n "oss-sec"`
#	to "$HOME/.mail/.list_distros"
#}

# if( /^(To|Cc):.*xorg-security@.*/:h || /^(To|Cc):.*xorg_security@.*/:h )
# {
# 	to "$HOME/.mail/.list_xorg"
# }

# if( /^(To|Cc):.*xen-security-issues.*lists.*/:h )
# {
# 	FLAGS="S"
# 	to "$HOME/.mail/.list_xen"
# }

# if( /^(To|Cc).*security@gnome.org.*/:h )
# {
# 	FLAGS="S"
# 	to "$HOME/.mail/.list_gnome"
# }

if( /^(To|Cc).*security@ceph.com.*/:h || /^(To|Cc).*security@ceph.io.*/ )
{
	FLAGS="S"
	to "$HOME/.mail/.list_ceph"
}

# if( /^(To|Cc):.*tpm2@lists.01.org.*/:h )
# {
# 	FLAGS="S"
# 	to "$HOME/.mail/.list_tpm"
# }

if( /^List-Id:.*research.suse.de/:h )
{
	to "$HOME/.mail/.research"
}

if( /^List-Id:.*users.suse.de/:h )
{
	to "$HOME/.mail/.users"
}

if( /^List-Id:.*galaxy-devel.suse.de/:h )
{
	to "$HOME/.mail/.suma-devel"
}

if( /^List-Id:.*devel.suse.de/:h )
{
	to "$HOME/.mail/.devel"
}

# new bugs for the secteam should light up

if( /^From: bugzilla_noreply@suse.com/:h && /^To: .*security-team@suse.de.*/:h && /^Subject.* New: .*/:h )
{
	to "$HOME/.mail/.new_sec_bugs"
}

# anything that happens in AUDIT bugs should light up

if( /^From: bugzilla_noreply@suse.com/:h && /^To: .*security-team@suse.de.*/ && /^Subject:.* AUDIT-[01]: .*/:h )
{
	to "$HOME/.mail/.audits"
}

if( /^From: bugzilla_noreply@suse.com/:h && /^To: .*paolo.perego@suse.com.*/:h )
{
	to "$HOME/.mail/.bugzilla_mine"
}

# all other bugzilla stuff has proven to be nonsense

if( /^From: bugzilla_noreply@suse.com/:h )
{
	FLAGS="S"
	to "$HOME/.mail/.bugzilla"
}

# QA and overly verbose update MGM stuff

# if( /^To: qa-maintenance-reports@suse.de/:h )
# {
# 	FLAGS="S"
# 	to "$HOME/.mail/.qa"
# }

# if( /^From:.*maint-coord@suse.de/:h && /^To: .*security-team@suse.de/:h && /^.*Update workflow started.*/:h )
# {
# 	FLAGS="S"
# 	to "$HOME/.mail/.updates"
# }

if( /^From:.*maint-coord@suse.de/:h && /^To: .*security-team@suse.de/:h && /^.*Maintenance update request for.*/:h )
{
	FLAGS="S"
	to "$HOME/.mail/.updates"
}

if( /^From:.*swamp_noreply@suse.de/:h && /^To: security-team@suse.de/:h )
{
	FLAGS="S"
	to "$HOME/.mail/.updates"
}

# collect work reports into extra mailbox

if( /^To: .*security_team@suse.de/:h && /^Subject:.*[wW]ork.*[Rr]eport.*/:h )
{
	to "$HOME/.mail/.reports"
}

if( /^Cc: .*security_team@suse.de/:h && /^Subject:.*[wW]ork.*[Rr]eport.*/:h )
{
	to "$HOME/.mail/.reports"
}

# security mailing list, more interesting

if( /^(To|Cc): .*security-team@suse.de/:h )
{
	# this is more like an agent
	if( /^Subject: .*Missing submission for.*/:h )
	{
		to "$HOME/.mail/.security"
	}
	else
	{
		#`$HOME/bin/mail_status.py -n "security"`
		to "$HOME/.mail/.security"
	}
}

# anything else security external etc.

if( /^(To|Cc): .*security@suse.de/:h || /^Subject: .*security@suse.de.*/:h || /^List-Id:.*security.suse.de/:h )
{
	#`$HOME/bin/mail_status.py -n "security"`
	to "$HOME/.mail/.security"
}

# if( /^List-Id: .*factory.lists.opensuse.org/:h )
# {
	# if( ! /gerstner/:b )
	# {
		# FLAGS="S"
	# }
	# to "$HOME/.mail/.list_factory"
# }

# if( /^List-Id: .*connman.lists.linux.dev/:h )
# {
	# if( ! /gerstner/:h )
	# {
		# FLAGS="S"
	# }
	# to "$HOME/.mail/.list_connman"
# }

# if( /^X-Mailinglist: opensuse-kernel/:h )
# {
	# only mark mails somehow related to me as NEW
	# if( ! /gerstner/:b )
	# {
		# FLAGS="S"
	# }
	# to "$HOME/.mail/.kernel"
# }

if( /^List-Id:.*users.lists.opensuse.org.*/:h )
{
	to "$HOME/.mail/.opensuse_users"
}

if( /^List-Id:.*project.lists.opensuse.org.*/:h )
{
	to "$HOME/.mail/.opensuse_project"
}


# if( /^List-Id:.*openvpn-info@suse.de/:h || /^List-Id:.*openvpn-info.suse.de/:h )
# {
	# FLAGS="S"
	# to "$HOME/.mail/.vpn"
# }

# if( /^List-Id:.*.github.com/:h )
# {
	# to "$HOME/.mail/.github"
# }

# any assorted lists (which I'm a member of explicitly or implicitly)

# if( /^List-Id:.*/:h )
# {
	# to "$HOME/.mail/.list_misc"
# }

# `$HOME/bin/mail_status.py -n unknown`

# if its somehow directed to SUSE at least, put it into the inbox
if( /^To:.*suse\.(de|com).*/:h )
{
	to "$HOME/.mail/.inbox"
}

# these notifications aren't sent to my mail address, but to
# <repo>@noreply.github.com
# if( /^From:.*notifications@github.com.*/:H )
# {
	# to "$HOME/.mail"
# }

if( /^From: .*marketing.*/:h )
{
	to "$HOME/.mail/.spam"
}

if( /^From: .*mailing@.*/:h )
{
	to "$HOME/.mail/.spam"
}

if( /^X-Spam-Flag: YES/:h )
{
	to "$HOME/.mail/.spam"
}

# anything else is highly suspected to be spam
to "$HOME/.spam"
